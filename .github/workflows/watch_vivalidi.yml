name: Vivaldi Blog Update Watcher

on:
  schedule:
    - cron: "0 23 * * *"   # æ¯æ—¥ æœ8æ™‚ï¼ˆJSTï¼‰
  workflow_dispatch:

jobs:
  watch:
    runs-on: ubuntu-latest
    steps:
      - name: Restore previous schedule cache
        uses: actions/cache@v4
        with:
          path: prev
          key: schedule-prev

      - name: Run watcher script
        id: diff
        run: |
          chmod +x .github/scripts/watch_vivaldi.sh
          .github/scripts/watch_vivaldi.sh

      - name: Notify Discord
        if: steps.diff.outputs.changed == 'true'
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          DISCORD_USER_ID: ${{ secrets.DISCORD_USER_ID }}
        run: |
          curl -X POST "$DISCORD_WEBHOOK_URL" \
            -H "Content-Type: application/json" \
            -d "{\"content\": \"<@${DISCORD_USER_ID}> ğŸ””Vivaldiãƒ–ãƒ­ã‚°ï¼ˆæœ€æ–°è¨˜äº‹ï¼‰ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ\nhttps://vivaldi.com/ja/blog/latest/\", \"allowed_mentions\": {\"users\": [\"${DISCORD_USER_ID}\"]}}"

      - name: Save schedule cache
        if: always()
        uses: actions/cache@v4
        with:
          path: prev
          key: schedule-prev
          