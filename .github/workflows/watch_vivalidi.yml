name: Vivaldi Blog Update Watcher

on:
  schedule:
    - cron: "0 23 * * *"   # æ¯æ—¥ æœ8æ™‚ï¼ˆJSTï¼‰
  workflow_dispatch:

jobs:
  watch:
    runs-on: ubuntu-latest
    steps:
      - name: Fetch latest blog page
        run: |
          curl -s https://vivaldi.com/ja/blog/latest/ > current.html

      - name: Compare with previous
        id: diff
        run: |
          if [ -f prev.html ]; then
            diff prev.html current.html || echo "changed=true" >> $GITHUB_OUTPUT
          else
            echo "changed=true" >> $GITHUB_OUTPUT
          fi
          mv current.html prev.html

      - name: Notify Discord
        if: steps.diff.outputs.changed == 'true'
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          curl -X POST \
            -H "Content-Type: application/json" \
            -d '{"content":"@everyone ğŸ”” Vivaldiãƒ–ãƒ­ã‚°ï¼ˆæœ€æ–°è¨˜äº‹ï¼‰ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ\nhttps://vivaldi.com/ja/blog/latest/"}' \
            "$DISCORD_WEBHOOK_URL"
