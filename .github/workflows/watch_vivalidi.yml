name: Vivaldi Blog Update Watcher

on:
  schedule:
    - cron: "0 23 * * *"   # æ¯æ—¥ æœ8æ™‚ï¼ˆJSTï¼‰
  workflow_dispatch:

jobs:
  watch:
    runs-on: ubuntu-latest
    steps:
      - name: Download previous HTML (if exists)
        uses: actions/download-artifact@v4
        with:
          name: prev-html
          path: ./prev

      - name: Fetch latest blog page
        run: |
          curl -s https://vivaldi.com/ja/blog/latest/ > current.html

      - name: Compare with previous
        id: diff
        run: |
          changed=false
          mkdir -p prev
          if [ -f prev/prev.html ]; then
            diff prev/prev.html current.html || changed=true
          else
            changed=true
          fi
          # æ¬¡å›æ¯”è¼ƒç”¨ã« current.html ã‚’ prev/prev.html ã«ã‚³ãƒ”ãƒ¼
          cp current.html prev/prev.html
          echo "changed=$changed" >> $GITHUB_OUTPUT

      - name: Notify Discord
        if: steps.diff.outputs.changed == 'true'
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          DISCORD_USER_ID: ${{ secrets.DISCORD_USER_ID }}
        run: |
          curl -X POST \
            -H "Content-Type: application/json" \
            -d "{\"content\":\"<@${DISCORD_USER_ID}> ğŸ”” Vivaldiãƒ–ãƒ­ã‚°ï¼ˆæœ€æ–°è¨˜äº‹ï¼‰ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ\nhttps://vivaldi.com/ja/blog/latest/\"}" \
            "$DISCORD_WEBHOOK_URL"

      - name: Save current HTML as artifact
        uses: actions/upload-artifact@v4
        with:
          name: prev-html
          path: prev/prev.html
          